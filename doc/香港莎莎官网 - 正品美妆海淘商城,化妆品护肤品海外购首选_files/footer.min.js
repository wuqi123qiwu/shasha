
var Shop=window['Shop']||shopDefine;window.addEvent('domready',function(){var __time_out=1000;if(Shop.set!=undefined&&Shop.set.refer_timeout)__time_out=Shop.set.refer_timeout;var ReferObj={};Object.append(ReferObj,{serverTime:smartyNow,init:function(){var FIRST_REFER=Memory.get('first_refer');var NOW_REFER=Memory.get('now_refer');var nowDate=this.time=this.serverTime*1000;if(!window.location.href.test('#r-')&&!document.referrer||document.referrer.test(document.domain))return;if(window.location.href.test('#r-'))Memory.clean('n');if(!FIRST_REFER){if(NOW_REFER){Memory.set('first_refer',NOW_REFER,this.getTimeOut(JSON.decode(NOW_REFER).DATE));}else{this.setRefer('first_refer',__time_out);}}
this.setRefer('now_refer',__time_out);this.createGUID();},getUid:function(){var lf=window.location.href,pos=lf.indexOf('#r-');return pos!=-1?lf.substr(pos+4):'';},getRefer:function(){return document.referrer?document.referrer:'';},setRefer:function(referName,timeout){var uid=this.getUid(),referrer=this.getRefer();var data={'ID':uid,'REFER':referrer,'DATE':this.time};if('now_refer'==referName){var refer=JSON.decode(Memory.get('first_refer'));if(uid!=''&&refer&&refer.ID==''){var fdata={'ID':uid,'REFER':refer.REFER,'DATE':refer.DATE};Memory.set('first_refer',JSON.encode(fdata),this.getTimeOut(refer.DATE));}else if(uid==''){Object.append(data,{'ID':refer.ID});}}
Memory.set(referName,JSON.encode(data),__time_out||15);},getTimeOut:function(nowDate){var timeout=nowDate+__time_out*24*3600*1000;var date=new Date(timeout);return date;},createGUID:function(){var GUID=(function(){var S4=function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};return(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()).toUpperCase();})();Memory.set('n',GUID,3650);}});ReferObj.init();if(JQ('.tbl_16th_result').length>0){JQ.ajax({url:'/order-top_sales_members.html',type:'GET',data:{},dataType:'json',timeout:9000,error:function(){console.log('Error loading /order-top_sales_members.html');},success:function(res){if(res){for(var i=0;i<res.length;i++)
{var reward_money=2000;if((i+1)==1)
reward_money=2000;else if((i+1)==2)
reward_money=1500;else if((i+1)==3)
reward_money=1000;else if((i+1)==4)
reward_money=800;else if((i+1)==5)
reward_money=700;else if((i+1)>=6)
reward_money=500;var html='<div class="row'+(i+1)+'"><div class="r_name">'+res[i].member_nickname+'</div> <div class="r_price">'+reward_money+'</div> <div class="r_mail">'+res[i].member_email+'</div> <div class="r_cost">'+res[i].order_amount+'</div></div>';JQ('.tbl_16th_result').append(html);}}}});}
else{}});miniCart={'show':function(target){target=$(target);if(!target)return;if(this.dialog){this.hide();}
var options={body:'popup-body',header:'popup-header',close:'popup-btn-close',content:'popup-content',title:memo1,main:'<div class="loading">loading...</div>'},dialog=this.dialog=new Element('div#mini_cart_dialog.popup-container.mini-cart-dialog',{'html':$('popup_template').get('html').substitute(options),styles:{display:'block',zIndex:maxZindex('div',1)}}).inject(document.body);this.title=dialog.getElement('.popup-header h2');this.close=dialog.getElements('.popup-btn-close');this.content=dialog.getElement('.popup-content');this.dialog.addEvent('click:relay(.popup-btn-close)',this.hide.bind(this));var setSize=this.setSize=function(){if(!dialog.isDisplayed())return;var xleft=0;if(document.body.scrollLeft==0){xleft=(document.documentElement.clientWidth-dialog.clientWidth)/2+document.body.scrollLeft;}else{xleft=(document.body.scrollWidth-document.body.scrollLeft-dialog.clientWidth)/2+document.body.scrollLeft;}
var xtop=0;if(document.body.scrollTop==0){xtop=(document.documentElement.clientHeight-dialog.clientWidth)/2+document.documentElement.scrollTop;}else{xtop=(document.documentElement.clientHeight-dialog.clientWidth)/2+document.body.scrollTop;}
dialog.setStyles({left:xleft,top:xtop,position:'absolute'});};setSize();window.addEvent('resize',setSize);},'hide':function(){try{this.dialog.destroy();window.removeEvent('resize',this.setSize);}catch(e){}},'load':function(options){options=options||{};options=Object.merge({method:'post',onRequest:function(){miniCart.show(options.target);},onSuccess:function(re){if(re){this.title.innerHTML=memo2;this.content.innerHTML=re;}
updateCartInfo();if(document.getElement('.minicart_box')&&document.getElement('.minicart_box').get('show_gallery')){document.getElement('.minicart_box').fireEvent('_show');}
var _this=this;new Request.HTML({url:link1,update:$('js_updatecart'),onComplete:function(){JQ('#js_updatecart .sidecart-list').css({'height':findWindowHeight()-145});JQ('#js_updatecart .sidecart-totle').css({'position':'absolute'});JQ('#js_updatecart .sidecart-totle').css({'bottom':'50px'});$("js_cartnum").set('html',JQ('#J_sidecart-totalitem').text());setTimeout(function(){try{_this.dialog.destroy();window.removeEvent('resize',_this.setSize);}catch(e){}},10000);}}).send();options.callback&&options.callback(re);}.bind(this),onFailure:function(xhr){this.title.innerHTML=memo3;this.content.innerHTML='<div class="minicart-error"><p align="center">'+memo4+'<br />'+memo5+'</p></div>';}.bind(this)},options||{});if(!options.url)return false;new Request(options).send(options.data?options.data.toQueryString()+'&mini_cart=true':'mini_cart=true');},init:function(target,url,data){var linktocart;if(typeOf(target)=='element')linktocart=target.getElements('[target=_dialog_minicart]');else if(typeOf(target)=='elements')linktocart=target;else linktocart=$$('a[target=_dialog_minicart], button[target=_dialog_minicart]');if(linktocart.length){linktocart.addEvent('click',function(e){var _self=this;e.preventDefault();offset={top:e.event.y,left:e.event.x}
var _con,_tmpimg;if(0<JQ(_self).parents('.formall').length){_con=JQ(_self).parents('.formall');_tmpimg=_con.find('.action-goods-img').attr('src');}else if(0<JQ(_self).parents('#product-tags').length){_con=JQ('#product_container').find('.thumbnail');_tmpimg=_con.find('a:first-child img').attr('src');}
miniCart.load({url:url||this.href,data:data||this.getParent('.goods-item')||this.getParent('li'),target:this});});}}};var formToCart=function(container,target){container=$(container||document.body);target=target||'.action-addtocart';if(!container)return;var formtocart=container.getElement('form[target=_dialog_minicart]')||container.getFirst().getParent('form[target=_dialog_minicart]');if(formtocart){formtocart.addEvent('submit',function(e){e.stop();target=this.getElement(target)||this.getElement('*[type=submit]');var offset={top:JQ(target).offset().top-window.scrollY,left:JQ(target).offset().left+JQ(target).outerWidth()/2,},_con,_tmpimg;if(0<formtocart.length){_con=JQ('#product_container').find('.thumbnail');_tmpimg=_con.find('a:first-child img').attr('src');}
miniCart.load({url:this.action,method:this.method,data:this,target:target,callback:function(){target.removeClass('disabled');}.bind(this)});});};}
var getMixedName=function(container,target,lable){container=$(container||document.body);target=target||'.ajax-domready-getmixname';lable=lable||'data-sku';if(!container)return false;var objGroup=container.getElements(target);var post='';if(objGroup){for(var i=0;i<objGroup.length;i++){if(objGroup[i].getProperty(lable)){post+=objGroup[i].getProperty(lable)+'|';}}}
if(post){var data=post.substring(0,post.length-1);new Request({url:link2,method:'post',data:'sku='+encodeURIComponent(data.trim()),onSuccess:function(res){if(res=='sku_undefined'){return false;}
var ret=JSON.decode(res);for(var j=0;j<objGroup.length;j++){for(var k=0;k<ret.length;k++){if(objGroup[j].getProperty(lable)==ret[k]['sku']){if(objGroup[j].getProperty(lable).tagName=="INPUT"){objGroup[j].set('value',ret[k]['mix_name']);break;}
else{objGroup[j].set('html',ret[k]['mix_name']);break;}}}}},onFailure:function(xhr){return false;}}).send();}else{return false;}}
var fromGetPrice=function(container,target,lable){container=$(container||document.body);target=target||'.ajax-domready-getprice';lable=lable||'data-sku';if(!container)return false;var objGroup=container.getElements(target);var post='';if(objGroup){for(var i=0;i<objGroup.length;i++){if(objGroup[i].getProperty(lable)){post+=objGroup[i].getProperty(lable)+'|';}}}
if(post){var data=post.substring(0,post.length-1);new Request({url:link3,method:'post',data:'sku='+encodeURIComponent(data.trim()),onSuccess:function(res){if(res=='sku_undefined'){return false;}
var ret=JSON.decode(res);for(var j=0;j<objGroup.length;j++){for(var k=0;k<ret.length;k++){if(objGroup[j].getProperty(lable)==ret[k]['sku']){if(objGroup[j].getProperty(lable).tagName=="INPUT"){objGroup[j].set('value',ret[k]['price']);break;}
else{objGroup[j].set('html',ret[k]['price']);break;}}}}},onFailure:function(xhr){return false;}}).send();}else{return false;}}
var checkStorage=function(container,target,lable){container=$(container||document.body);target=target||'.ajax-domready-checkinventory';lable=lable||'data-sku';if(!container)return false;var objGroup=container.getElements(target);var post='';if(objGroup){for(var i=0;i<objGroup.length;i++){if(objGroup[i].getProperty(lable)){post+=objGroup[i].getProperty(lable)+'|';}}}
if(post){var data=post.substring(0,post.length-1);new Request({url:link4,method:'post',data:'sku='+encodeURIComponent(data.trim()),onSuccess:function(res){if(res=='sku_undefined'){return false;}
var ret=JSON.decode(res);for(var j=0;j<objGroup.length;j++){for(var k=0;k<ret.length;k++){if(objGroup[j].getProperty(lable)==ret[k]['sku']){if(objGroup[j].getProperty(lable).tagName=="INPUT"){break;}
else{if(!ret[k]['store']){objGroup[j].removeClass('hide');}
break;}}}}},onFailure:function(xhr){return false;}}).send();}else{return false;}}
var fromGetMktPrice=function(container,target,lable){container=$(container||document.body);target=target||'.ajax-domready-getmktprice';lable=lable||'data-sku';if(!container)return false;var objGroup=container.getElements(target);var post='';if(objGroup){for(var i=0;i<objGroup.length;i++){if(objGroup[i].getProperty(lable)){post+=objGroup[i].getProperty(lable)+'|';}}}
if(post){var data=post.substring(0,post.length-1);new Request({url:link5,method:'post',data:'sku='+encodeURIComponent(data.trim()),onSuccess:function(res){if(res=='sku_undefined'){return false;}
var ret=JSON.decode(res);for(var j=0;j<objGroup.length;j++){for(var k=0;k<ret.length;k++){if(objGroup[j].getProperty(lable)==ret[k]['sku']){if(objGroup[j].getProperty(lable).tagName=="INPUT"){objGroup[j].set('value',ret[k]['mktprice']);break;}
else{objGroup[j].set('html',ret[k]['mktprice']);break;}}}}},onFailure:function(xhr){return false;}}).send();}else{return false;}}
window.addEvent('domready',function(){withBrowserStore(function(browserStore){browserStore.get('history',function(v){v=JSON.decode(v);if(!v||!v.length||!JQ('.sidebar').length){miniCart.init();formToCart();}});});setTimeout(function(){fromGetPrice();checkStorage();getMixedName();fromGetMktPrice();},5000);});